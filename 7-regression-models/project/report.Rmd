---
title: 'Regression Models Course Project - Transmission effect on car MPG performance'
author: "Henrique Souza (github.com/htssouza)"
output:
  html_document: default
  pdf_document:
    pandoc_args:
    - +RTS
    - -K64m
    - -RTS
---

# Executive Summary

# Data Analysis

```{r echo = FALSE, message = FALSE}
library(datasets)
library(dplyr)
library(ggplot2)
library(GGally)
library(stats)
data(mtcars)
mtcars <- mtcars %>%
  mutate(am = am + 1) %>%
  mutate(am = factor(am))
levels(mtcars$am) <- c("auto", "manual")
```

MPG distribution by Transmission:

```{r echo = FALSE}
g <- ggplot(data = mtcars, aes(am, mpg, fill = am))
g <- g + geom_violin(stat = "ydensity", color = "black", size = 2)
g <- g + xlab("Type of transmission")
g <- g + ylab("MPG density")
g
```

# Models

Based on the understanding of the dataset and the variables pairs plot (see Appendix),
the following models were selected for comparison:

1. Using only the Transmission.
1. Transmission and Weight.
1. Transmission, Weight and Cylinders.
1. Transmission, Weight, Cylinders and Displacement.
1. Transmission, Weight, Cylinders, Displacement and Gears.

Other variables are being ignored:

- HP because it is a product of other variables (like Cylinders and Displacement).
- Axle Ratio (not much related to MPG efficience).
- Quarter of mile performance (somewhat related to HP).
- Engine type and Carburators which can be linked to transmission type as well.

We will be using linear models as MPG is not a binary or a count variable.

Fitting our models:
```{r echo = TRUE}
mod1 <- lm(mpg ~ am, data = mtcars)
mod2 <-  lm(mpg ~ am + wt, data = mtcars)
mod3 <-  lm(mpg ~ am + wt + cyl, data = mtcars)
mod4 <-  lm(mpg ~ am + wt + cyl + disp, data = mtcars)
mod5 <-  lm(mpg ~ am + wt + cyl + disp + gear, data = mtcars)
```

# Model selection

Using anova function to compare models:

```{r echo = TRUE}
anova(mod1, mod2, mod3, mod4, mod5)
```

The p-values for Model 4 is already too big (>= 0.05).
We will stick with Model 3.

# Residual Analsysis

Plotting the residuals for our choosen model:

```{r echo = FALSE, message = FALSE}
mpghat <- predict(mod2)
resid <- mtcars$mpg - mpghat

g <- ggplot(data.frame(x = mtcars$mpg, y = resid), aes(x = x, y = y))
g <- g + geom_hline(yintercept = 0, size = 2)
g <- g + geom_col(size = 0.5, color = "red")
g <- g + geom_point(size = 2, color = "black")
g <- g + geom_point(size = 1, color = "white")
g <- g + geom_smooth(method = "auto")
g <- g + xlab("MPG")
g <- g + ylab("Model Residual")
g
```

# Conclusion

# Appendix

Plotting variable pairs (linear model fitting lines):
```{r echo = FALSE, message = FALSE}
ggpairs(mtcars, lower = list(continuous = wrap("smooth", method = "lm")))
```
